<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ªåˆ‡æ¿æƒé™æµ‹è¯• - LLM Assistant</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .copy-text {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            border: 1px dashed #6c757d;
            margin: 10px 0;
            user-select: all;
        }
        .log-area {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.unknown { background: #ffc107; color: #856404; }
        .status.granted { background: #d4edda; color: #155724; }
        .status.denied { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ”’ å‰ªåˆ‡æ¿æƒé™æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h2>
        <ol>
            <li><strong>å®‰è£…æ‰©å±•</strong>ï¼šç¡®ä¿ LLM Assistant æ‰©å±•å·²å®‰è£…å¹¶å¯ç”¨</li>
            <li><strong>å¤åˆ¶æ–‡æœ¬</strong>ï¼šé€‰æ‹©ä¸‹é¢çš„æµ‹è¯•æ–‡æœ¬å¹¶å¤åˆ¶ (Cmd/Ctrl+C)</li>
            <li><strong>è§‚å¯Ÿæƒé™å¯¹è¯æ¡†</strong>ï¼šåº”è¯¥å¼¹å‡ºæƒé™è¯·æ±‚å¯¹è¯æ¡†</li>
            <li><strong>ç‚¹å‡»å…è®¸</strong>ï¼šåœ¨å¯¹è¯æ¡†ä¸­ç‚¹å‡»"å…è®¸è®¿é—®å‰ªåˆ‡æ¿"</li>
            <li><strong>éªŒè¯åŠŸèƒ½</strong>ï¼šåº”è¯¥çœ‹åˆ° LLM Assistant çš„åŠŸèƒ½é€‰æ‹©æ¡†</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•æ–‡æœ¬</h2>
        <p>é€‰æ‹©ä»¥ä¸‹æ–‡æœ¬å¹¶å¤åˆ¶ä»¥æµ‹è¯•æƒé™è¯·æ±‚ï¼š</p>
        <div class="copy-text" id="testText1">
            Hello, this is a test text for clipboard permission testing. ä½ å¥½ï¼Œè¿™æ˜¯ç”¨äºæµ‹è¯•å‰ªåˆ‡æ¿æƒé™çš„æ–‡æœ¬ã€‚
        </div>
        <div class="copy-text" id="testText2">
            å¦ä¸€æ®µæµ‹è¯•æ–‡æœ¬ï¼šThe quick brown fox jumps over the lazy dog. è¿™æ˜¯ä¸€ä¸ªåŒ…å«ä¸­è‹±æ–‡çš„æµ‹è¯•æ®µè½ã€‚
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ” æƒé™çŠ¶æ€æ£€æŸ¥</h2>
        <div id="permissionStatus" class="status unknown">
            æ£€æŸ¥ä¸­...
        </div>
        <button class="test-button" onclick="checkPermissions()">ğŸ”„ é‡æ–°æ£€æŸ¥æƒé™</button>
        <button class="test-button" onclick="testClipboardRead()">ğŸ“– æµ‹è¯•è¯»å–å‰ªåˆ‡æ¿</button>
        <button class="test-button" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        <button class="test-button" onclick="resetExtensionState()">ğŸ”„ é‡ç½®æ‰©å±•çŠ¶æ€</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š å®æ—¶æ—¥å¿—</h2>
        <div id="logArea" class="log-area">ç­‰å¾…æ“ä½œ...</div>
    </div>

    <div class="test-section">
        <h2>â“ å¸¸è§é—®é¢˜</h2>
        <details>
            <summary><strong>æƒé™å¯¹è¯æ¡†æ²¡æœ‰å¼¹å‡º</strong></summary>
            <ul>
                <li>ç¡®ä¿æ‰©å±•å·²å®‰è£…å¹¶å¯ç”¨</li>
                <li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯</li>
                <li>å°è¯•åˆ·æ–°é¡µé¢é‡æ–°åŠ è½½æ‰©å±•</li>
                <li>æ£€æŸ¥æ‰©å±•æ˜¯å¦æœ‰æƒé™åœ¨å½“å‰é¡µé¢è¿è¡Œ</li>
            </ul>
        </details>
        <details>
            <summary><strong>æƒé™å¯¹è¯æ¡†ä¸€é—ªè€Œè¿‡</strong></summary>
            <ul>
                <li>è¿™é€šå¸¸è¡¨ç¤ºæƒé™è¯·æ±‚é€»è¾‘æœ‰é—®é¢˜</li>
                <li>è¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯</li>
                <li>å°è¯•ç‚¹å‡»"é‡ç½®æ‰©å±•çŠ¶æ€"æŒ‰é’®</li>
            </ul>
        </details>
        <details>
            <summary><strong>è·å¾—æƒé™ååŠŸèƒ½ä¸å·¥ä½œ</strong></summary>
            <ul>
                <li>æ£€æŸ¥å‰ªåˆ‡æ¿å†…å®¹æ˜¯å¦æœ‰æ•ˆï¼ˆä¸æ˜¯ç©ºç™½æˆ–å¤ªçŸ­ï¼‰</li>
                <li>ç¡®ä¿å¤åˆ¶æ“ä½œæˆåŠŸæ‰§è¡Œ</li>
                <li>æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—äº†è§£è¯¦ç»†é”™è¯¯</li>
            </ul>
        </details>
    </div>

    <script>
        let logCount = 0;
        
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logCount++;
            logArea.textContent += `[${timestamp}] ${logCount}: ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logArea').textContent = 'æ—¥å¿—å·²æ¸…ç©º...\n';
            logCount = 0;
        }

        async function checkPermissions() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥å‰ªåˆ‡æ¿æƒé™çŠ¶æ€...');
            
            try {
                if (!navigator.permissions) {
                    log('âŒ æµè§ˆå™¨ä¸æ”¯æŒæƒé™API');
                    updatePermissionStatus('unknown', 'æµè§ˆå™¨ä¸æ”¯æŒæƒé™API');
                    return;
                }

                const permission = await navigator.permissions.query({ name: 'clipboard-read' });
                log(`ğŸ“‹ å‰ªåˆ‡æ¿æƒé™çŠ¶æ€: ${permission.state}`);
                
                updatePermissionStatus(permission.state, `å‰ªåˆ‡æ¿æƒé™çŠ¶æ€: ${permission.state}`);
                
                // ç›‘å¬æƒé™å˜åŒ–
                permission.onchange = () => {
                    log(`ğŸ”„ æƒé™çŠ¶æ€å˜åŒ–: ${permission.state}`);
                    updatePermissionStatus(permission.state, `å‰ªåˆ‡æ¿æƒé™çŠ¶æ€: ${permission.state}`);
                };
                
            } catch (error) {
                log(`âŒ æ£€æŸ¥æƒé™å¤±è´¥: ${error.message}`);
                updatePermissionStatus('unknown', `æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }

        function updatePermissionStatus(state, message) {
            const statusDiv = document.getElementById('permissionStatus');
            statusDiv.className = `status ${state}`;
            statusDiv.textContent = message;
        }

        async function testClipboardRead() {
            log('ğŸ“– æµ‹è¯•ç›´æ¥è¯»å–å‰ªåˆ‡æ¿...');
            
            try {
                const text = await navigator.clipboard.readText();
                log(`âœ… æˆåŠŸè¯»å–å‰ªåˆ‡æ¿: "${text.substring(0, 50)}${text.length > 50 ? '...' : ''}"`);
            } catch (error) {
                log(`âŒ è¯»å–å‰ªåˆ‡æ¿å¤±è´¥: ${error.name} - ${error.message}`);
                if (error.name === 'NotAllowedError') {
                    log('ğŸ’¡ æç¤º: éœ€è¦ç”¨æˆ·æˆæƒæ‰èƒ½è¯»å–å‰ªåˆ‡æ¿');
                }
            }
        }

        async function resetExtensionState() {
            log('ğŸ”„ é‡ç½®æ‰©å±•çŠ¶æ€...');
            
            try {
                // æ¸…é™¤æ‰©å±•å­˜å‚¨
                if (typeof chrome !== 'undefined' && chrome.storage) {
                    await chrome.storage.local.clear();
                    log('âœ… å·²æ¸…é™¤æ‰©å±•å­˜å‚¨');
                } else {
                    log('â„¹ï¸ æ— æ³•è®¿é—®æ‰©å±•å­˜å‚¨API');
                }
                
                // é‡æ–°åŠ è½½é¡µé¢
                setTimeout(() => {
                    log('ğŸ”„ å³å°†é‡æ–°åŠ è½½é¡µé¢...');
                    location.reload();
                }, 1000);
                
            } catch (error) {
                log(`âŒ é‡ç½®å¤±è´¥: ${error.message}`);
            }
        }

        // ç›‘å¬å¤åˆ¶äº‹ä»¶
        document.addEventListener('copy', (event) => {
            const selection = window.getSelection().toString();
            if (selection) {
                log(`ğŸ“‹ æ£€æµ‹åˆ°å¤åˆ¶äº‹ä»¶: "${selection.substring(0, 30)}${selection.length > 30 ? '...' : ''}"`);
                log('â³ ç­‰å¾…æ‰©å±•å¤„ç†...');
            }
        });

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æƒé™
        window.addEventListener('load', () => {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ£€æŸ¥æƒé™çŠ¶æ€');
            checkPermissions();
            
            // æ£€æŸ¥æ‰©å±•æ˜¯å¦åŠ è½½
            setTimeout(() => {
                if (typeof window.llmAssistant !== 'undefined') {
                    log('âœ… æ£€æµ‹åˆ° LLM Assistant æ‰©å±•');
                } else {
                    log('âš ï¸ æœªæ£€æµ‹åˆ° LLM Assistant æ‰©å±•ï¼Œè¯·ç¡®ä¿æ‰©å±•å·²å®‰è£…å¹¶å¯ç”¨');
                }
            }, 1000);
        });

        // æ·»åŠ æµ‹è¯•æ–‡æœ¬ç‚¹å‡»å¤åˆ¶åŠŸèƒ½
        document.querySelectorAll('.copy-text').forEach((element, index) => {
            element.addEventListener('click', () => {
                const range = document.createRange();
                range.selectNodeContents(element);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                try {
                    document.execCommand('copy');
                    log(`ğŸ“‹ å·²å¤åˆ¶æµ‹è¯•æ–‡æœ¬ ${index + 1}`);
                } catch (error) {
                    log(`âŒ å¤åˆ¶å¤±è´¥: ${error.message}`);
                }
            });
        });
    </script>
</body>
</html> 